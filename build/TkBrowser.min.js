/* @hrimthurs/tackle 1.28.0 https://github.com/hrimthurs/Tackle @license MIT */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TkBrowser={})}(this,(function(e){"use strict";function t(e,t={},n=!1){let r="string"==typeof e?function(e){try{return new URL(decodeURIComponent(e||self.location.href))}catch{}}(e):e;if(r)for(const e in t){let o=t[e];if(void 0!==o){if("object"==typeof o&&null!==o){let e=Array.isArray(o)?o.map((e=>s(e,{string:e=>e}))):Object.entries(o).map((e=>`${e[0]}:${s(e[1],{string:e=>e})}`));o=e.length>0?e.join(","):s(o)}r.searchParams.set(e,n?encodeURIComponent(o):o)}}return r}function s(e,t={},n=!0){let r=t[typeof e];return r?r(e):n?JSON.stringify(e,((e,n)=>s(n,t,!1))):e}function n(e,t=!1){let s=Array.isArray(e)?[...e]:null!=e?[e]:[];return t?function(e,t=!1){let s=[...new Set(e)];t&&(e=s);return s}(s):s}function r(e,t={},s=null){const o=self.document.createElement(e),a=t.insertFirst??!1,i=t.subElements??[];return s&&(a?s.insertBefore(o,s.firstChild):s.appendChild(o)),Object.entries(t).forEach((e=>{const[t,s]=e,r="string"==typeof s,a="object"==typeof s;switch(t){case"attributes":a&&Object.entries(s).forEach((([e,t])=>{o.setAttribute(e,t)}));break;case"style":const e=a?Object.entries(s).reduce(((e,[t,s])=>e+`;${t}:${s}`),""):r?`;${s}`:"";o.style.cssText=(o.style.cssText??"")+e;break;case"class":n(s).forEach((e=>o.classList.add(e)));break;case"properties":a&&Object.entries(s).forEach((([e,t])=>{e in o&&(o[e]=t)}));break;case"children":n(s).forEach((e=>o.appendChild(e)))}})),i.forEach((e=>{const t=e.tagName;delete e.tagName,r(t,e,o)})),o}function o(e,t){const s=n(t.set),r=n(t.unset),o=n(t.toggle);document.querySelectorAll(e).forEach((e=>{s.forEach((t=>e.classList.add(t))),r.forEach((t=>e.classList.remove(t))),o.forEach((t=>e.classList.toggle(t)))}))}function a(e,t){const s=r("iframe",{style:{position:"relative",width:"100%",height:"100%","z-index":-1e4},attributes:{frameborder:"no"}},e).contentWindow;let n={width:null,height:null};s.addEventListener("resize",(()=>{const{width:s,height:r}=getComputedStyle(e);n.width===s&&n.height===r||(t({width:s,height:r}),n={width:s,height:r})})),s.dispatchEvent(new Event("resize"))}function i(e,t=!0){window.addEventListener("error",(s=>{t&&s.preventDefault(),e(s.message)})),window.addEventListener("unhandledrejection",(s=>{t&&s.preventDefault(),e(s.reason??"Unknown reason rejection")}))}function c(e=(()=>{})){return new Promise((t=>{const s=()=>{e(),t(!0)};"complete"!==document.readyState?document.addEventListener("readystatechange",(()=>{"complete"===document.readyState&&s()})):s()}))}function d(e,s={}){const n={method:"GET",responseType:"arraybuffer",params:{},headers:{},id:null,timeout:1e4,useCache:!0,useReject:!1,setGetAsFolder:!1,addPostQString:!1,postSendType:"STRING",cbLoad:(e,t)=>{},cbError:(e,t,s)=>{},cbFinal:(e,t,s)=>{},cbProgress:(e,t,s)=>{},...s},r="GET"===n.method,o="POST"===n.method;let a,i=r||o&&n.addPostQString&&"RAW"!==n.postSendType;r&&n.setGetAsFolder&&(e+=t(self.location.href,s.params).searchParams.toString(),i=!1);try{a=new URL(e)}catch{const t=new URL(self.location.href).origin;a=new URL(e,t)}return i&&t(a,s.params),n.useCache||a.searchParams.set("r",Math.random().toString()),new Promise(((e,t)=>{const s=new XMLHttpRequest;s.open(n.method,a,!0),s.responseType=n.responseType,s.timeout=n.timeout;for(let e in n.headers)s.setRequestHeader(e,n.headers[e]);if(s.onloadend=()=>{200!==s.status||"arraybuffer"===n.responseType&&0===s.response.byteLength?(n.cbError(s.status,s.response,n.id),n.useReject?t(s.status):e(null)):(n.cbLoad(s.response,n.id),e(s.response)),n.cbFinal(s.status,s.response,n.id)},s.onprogress=e=>{n.cbProgress(e.loaded,e.total,n.id)},o)switch(n.postSendType){case"RAW":s.send(n.params);break;case"STRING":s.send(JSON.stringify(n.params));break;case"FORM":const e=new FormData;for(const t in n.params)e.append(t,n.params[t]);s.send(e)}else s.send()}))}function l(e,t){const s=new Blob([JSON.stringify(t,null,"\t")],{type:"text/json"}),n=URL.createObjectURL(s);setTimeout((()=>URL.revokeObjectURL(n)),1e4),r("a",{properties:{type:"text/json",download:e,href:n}}).click()}new Array(256).fill(0).map(((e,t)=>(t<16?"0":"")+t.toString(16)));var p={createHTMLElement:r,applyClasses:o,setDivResizer:a,interceptErrors:i,onDocumentComplete:c,httpRequest:d,saveValAsJson:l};e.applyClasses=o,e.createHTMLElement=r,e.default=p,e.httpRequest=d,e.interceptErrors=i,e.onDocumentComplete=c,e.saveValAsJson=l,e.setDivResizer=a,Object.defineProperty(e,"__esModule",{value:!0})}));
